$targetDirectory = "C:\Tests\Files"
$encryptionKey = [byte[]] (1..32)
$files = Get-ChildItem -Path $targetDirectory

foreach ($file in $files) {
    $content = Get-Content -Path $file.FullName -Encoding Byte

    $aesProvider = New-Object System.Security.Cryptography.AesCryptoServiceProvider

    $aesProvider.Key = $encryptionKey

    $aesProvider.Mode = [System.Security.Cryptography.CipherMode]::CBC

    $aesProvider.GenerateIV()

    $iv = $aesProvider.IV

    $memoryStream = New-Object System.IO.MemoryStream

    $cryptoStream = New-Object System.Security.Cryptography.CryptoStream $memoryStream, $aesProvider.CreateEncryptor(), "Write"

    $memoryStream.Write($iv, 0, $iv.Length)

    $cryptoStream.Write($content, 0, $content.Length)

    $cryptoStream.FlushFinalBlock()

    $cryptoStream.Close()

    $memoryStream.Close()

    [System.IO.File]::WriteAllBytes($file.FullName + ".encrypted", $memoryStream.ToArray())

}

Write-Host "Operation completed."